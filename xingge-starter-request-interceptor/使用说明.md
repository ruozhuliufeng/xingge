# 请求拦截器使用说明

## 问题原因

您在项目中引入jar包后没有打印日志的原因是：**缺少Spring Boot自动配置文件**。

我已经为您创建了必要的自动配置文件：

1. `META-INF/spring.factories` - 兼容旧版本Spring Boot
2. `META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports` - 新版本Spring Boot

## 解决步骤

### 1. 重新打包jar

由于文件被占用，请按以下步骤操作：

1. **关闭IDE中所有相关项目**
2. **重新打包**：
   ```bash
   cd xingge-starter-request-interceptor
   mvn clean package -Dgpg.skip=true
   mvn install -Dgpg.skip=true
   ```

### 2. 在您的项目中配置

在 `application.yml` 中添加：

```yaml
xg:
  request:
    # 启用请求拦截器
    enabled: true
    # 存储类型（支持多选）
    storage-types:
      - LOG
    # 日志配置
    log:
      enabled: true
      level: INFO
    # HTTP客户端拦截配置
    http-client:
      enabled: true
      intercept-types:
        - REST_TEMPLATE
        - FEIGN_CLIENT
        - OK_HTTP
```

### 3. 验证配置

启动应用后，发送HTTP请求应该能看到类似以下的日志输出：

```
================================================================================
请求日志记录
================================================================================
请求时间: 2024-01-01T10:00:00
请求方法: GET
请求URL: http://example.com/api/test
请求头: {Content-Type=application/json}
请求体: {"test":"data"}
响应时间: 2024-01-01T10:00:01
响应状态: 200
响应头: {Content-Type=application/json}
响应体: {"result":"success"}
执行时间: 1000ms
--------------------------------------------------------------------------------
```

### 4. 多存储类型配置示例

如果需要同时输出日志和保存到MongoDB：

```yaml
xg:
  request:
    enabled: true
    storage-types:
      - LOG
      - MONGO
    log:
      enabled: true
      level: INFO
    mongo:
      enabled: true
      host: localhost
      port: 27017
      database: request_logs
      collection: http_requests
```

## 注意事项

1. 确保项目中包含了最新版本的jar包
2. 检查Spring Boot版本兼容性
3. 确保配置文件格式正确
4. 查看启动日志确认自动配置是否生效

## 故障排除

如果仍然没有日志输出，请检查：

1. **依赖是否正确引入**：
   ```xml
   <dependency>
       <groupId>tech.msop</groupId>
       <artifactId>xingge-starter-request-interceptor</artifactId>
       <version>0.0.2</version>
   </dependency>
   ```

2. **启动日志中是否有自动配置信息**：
   ```
   INFO: RequestInterceptorAutoConfiguration matched
   ```

3. **配置是否生效**：
   ```java
   @Autowired
   private RequestInterceptorProperty properties;
   
   // 检查配置
   System.out.println("Enabled: " + properties.isEnabled());
   System.out.println("Storage Types: " + properties.getStorageTypes());
   ```